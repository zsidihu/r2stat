let myChart,monitor;const Utils={svgElements:["rect","circle","ellipse","line","polyline","polygon","path","text","tspan","textPath","svg","g","defs","use","symbol","style","clipPath","mask","filter","pattern","linearGradient","radialGradient","title","desc","image"],$:t=>document.querySelector(t),$$:t=>document.querySelectorAll(t),cE(t,e={}){const n=Utils.svgElements.includes(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);for(const[t,o]of Object.entries(e))null!=o&&n.setAttribute(t,o);return n},addClass:(t,...e)=>(t instanceof Element?t:Utils.$(t))?.classList.add(...e),remClass:(t,...e)=>(t instanceof Element?t:Utils.$(t))?.classList.remove(...e),attr(t,e,n){const o=t instanceof Element?t:this.$(t);if(o)return void 0===n?o.getAttribute(e):void o.setAttribute(e,n)},text(t,e){const n=t instanceof Element?t:this.$(t);if(n)return void 0===e?n.textContent:void(n.textContent=e)},on:(t,e,n,o)=>{const a=t instanceof Element||t instanceof Document||t===window?t:Utils.$(t);a?.addEventListener(e,n,o)},off:(t,e,n,o)=>{const a=t instanceof Element||t instanceof Document||t===window?t:Utils.$(t);a?.removeEventListener(e,n,o)}},updateStats=async t=>{const e=monitor.token.value.trim(),n=monitor.accID.value.trim();if(!e||!n)return;t.disabled=!0,t.textContent="Retrieve Information",localStorage.setItem("r2_t",e),localStorage.setItem("r2_a",n);const o=`query GetR2Usage($accountTag: String!) {\n\t\tviewer { accounts(filter: { accountTag: $accountTag }) {\n\t\t\tr2OperationsAdaptiveGroups(limit: 100, filter: { datetime_geq: "${(new Date).toISOString().substring(0,7)}-01T00:00:00Z" }) {\n\t\t\t\tsum { requests } dimensions { actionType }\n\t\t\t}\n\t\t}}\n\t}`;try{const t=await fetch("/api/cf",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({query:o,variables:{accountTag:n}})}),a=(await t.json()).data.viewer.accounts[0].r2OperationsAdaptiveGroups;let i=0,s=0;a.forEach(t=>{const e=t.dimensions.actionType.toLowerCase();e.includes("put")||e.includes("delete")||e.includes("create")?i+=t.sum.requests:s+=t.sum.requests}),Utils.remClass("#results","hidden"),Utils.text("#valB",s.toLocaleString()),Utils.text("#valA",i.toLocaleString()),Utils.$("#barB").style.width=Math.min(s/1e7*100,100)+"%",Utils.$("#barA").style.width=Math.min(i/1e6*100,100)+"%";const r=Utils.$("#prediction"),l=(new Date).getDate(),c=new Date((new Date).getFullYear(),(new Date).getMonth()+1,0).getDate(),d=Math.round(s/l*c);r.dataset.head=`Current pace: ${(s/1e7*100).toFixed(2)}% used.`,r.dataset.body=`Est. monthly total: ${d.toLocaleString()} / 10M`,drawChart(i,s)}catch(t){console.error(t)}t.disabled=!1,t.textContent="Monitor Usage"},drawChart=(t,e)=>{const n=Utils.$("#usageChart").getContext("2d");myChart&&myChart.destroy(),myChart=new Chart(n,{type:"doughnut",data:{labels:["Used","Free"],datasets:[{data:[e,1e7-e],backgroundColor:["#f38020","#f1f1f1"],borderWidth:0}]},options:{maintainAspectRatio:!1,cutout:"80%",plugins:{legend:{position:"bottom"}}}})};Utils.on(window,"load",()=>{monitor=document.forms.monitor;const t=localStorage.getItem("r2_t"),e=localStorage.getItem("r2_a");t&&e&&(monitor.accID.value=e,monitor.token.value=t),Utils.on("#menu-toggle","change",t=>{t.target.checked?Utils.addClass(document.body,"menu-open"):Utils.remClass(document.body,"menu-open")}),Utils.$$(".nav-menu a").forEach(t=>{t.addEventListener("click",()=>{Utils.$("#menu-toggle").checked=!1,Utils.remClass(document.body,"menu-open")})}),Utils.on("#monitor","submit",t=>{event.preventDefault(),updateStats(t.target.updateButton)}),Utils.on(monitor.toggle,"click",t=>{const e=monitor.token,n=t.target.firstElementChild;n.replaceChildren(),"password"===e.type?(e.type="text",n.appendChild(Utils.cE("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"})),n.appendChild(Utils.cE("line",{x1:"1",y1:"1",x2:"23",y2:"23"}))):(e.type="password",n.appendChild(Utils.cE("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"})),n.appendChild(Utils.cE("circle",{cx:"12",cy:"12",r:"3"})))})}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js");