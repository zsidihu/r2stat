let myChart;const Utils={svgElements:["rect","circle","ellipse","line","polyline","polygon","path","text","tspan","textPath","svg","g","defs","use","symbol","style","clipPath","mask","filter","pattern","linearGradient","radialGradient","title","desc","image"],$:t=>document.querySelector(t),$$:t=>document.querySelectorAll(t),cE(t,e={}){const a=Utils.svgElements.includes(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);for(const[t,n]of Object.entries(e))null!=n&&a.setAttribute(t,n);return a},addClass:(t,...e)=>(t instanceof Element?t:Utils.$(t))?.classList.add(...e),remClass:(t,...e)=>(t instanceof Element?t:Utils.$(t))?.classList.remove(...e),attr(t,e,a){const n=t instanceof Element?t:this.$(t);if(n)return void 0===a?n.getAttribute(e):void n.setAttribute(e,a)},text(t,e){const a=t instanceof Element?t:this.$(t);if(a)return void 0===e?a.textContent:void(a.textContent=e)},on:(t,e,a,n)=>{const s=t instanceof Element||t instanceof Document||t===window?t:Utils.$(t);s?.addEventListener(e,a,n)},off:(t,e,a,n)=>{const s=t instanceof Element||t instanceof Document||t===window?t:Utils.$(t);s?.removeEventListener(e,a,n)}},updateStats=async()=>{const t=Utils.$("#apiToken").value.trim(),e=Utils.$("#accountId").value.trim();if(!t||!e)return;localStorage.setItem("r2_t",t),localStorage.setItem("r2_a",e);const a=`query GetR2Usage($accountTag: String!) {\n\t\tviewer { accounts(filter: { accountTag: $accountTag }) {\n\t\t\tr2OperationsAdaptiveGroups(limit: 100, filter: { datetime_geq: "${(new Date).toISOString().substring(0,7)}-01T00:00:00Z" }) {\n\t\t\t\tsum { requests } dimensions { actionType }\n\t\t\t}\n\t\t}}\n\t}`;try{const n=await fetch("/api/cf",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({query:a,variables:{accountTag:e}})}),s=(await n.json()).data.viewer.accounts[0].r2OperationsAdaptiveGroups;let o=0,i=0;s.forEach(t=>{const e=t.dimensions.actionType.toLowerCase();e.includes("put")||e.includes("delete")||e.includes("create")?o+=t.sum.requests:i+=t.sum.requests}),Utils.remClass("#results","hidden"),Utils.text("#valB",i.toLocaleString()),Utils.text("#valA",o.toLocaleString()),Utils.$("#barB").style.width=Math.min(i/1e7*100,100)+"%",Utils.$("#barA").style.width=Math.min(o/1e6*100,100)+"%";const c=Utils.$("#prediction"),l=(new Date).getDate(),r=new Date((new Date).getFullYear(),(new Date).getMonth()+1,0).getDate(),d=Math.round(i/l*r);c.dataset.head=`Current pace: ${(i/1e7*100).toFixed(2)}% used.`,c.dataset.body=`Est. monthly total: ${d.toLocaleString()} / 10M`,drawChart(o,i)}catch(t){console.error(t)}},drawChart=(t,e)=>{const a=Utils.$("#usageChart").getContext("2d");myChart&&myChart.destroy(),myChart=new Chart(a,{type:"doughnut",data:{labels:["Used","Free"],datasets:[{data:[e,1e7-e],backgroundColor:["#f38020","#f1f1f1"],borderWidth:0}]},options:{maintainAspectRatio:!1,cutout:"80%",plugins:{legend:{position:"bottom"}}}})};Utils.on("#updateStats","click",()=>{updateStats()}),Utils.on("#togglePassword","click",()=>{const t=Utils.$("#apiToken"),e=Utils.$("#eyeIcon");"password"===t.type?(t.type="text",e.innerHTML='<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>'):(t.type="password",e.innerHTML='<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>')}),Utils.on(window,"load",()=>{const t=localStorage.getItem("r2_t"),e=localStorage.getItem("r2_a");t&&e&&(Utils.$("#apiToken").value=t,Utils.$("#accountId").value=e)}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js");